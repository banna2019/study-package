

一、创建tidb用户(root用户下手动配置好ansible的配置让后进行操作):
ansible all -m shell -a 'useradd -m -d /home/tidb tidb'
ansible all -m shell -a 'echo "tidb123" |passwd --stdin tidb'

visudo
tidb    ALL=(ALL)       ALL
tidb   ALL=(ALL) NOPASSWD: ALL

ansible all -m copy -a 'src=/etc/sudoers dest=/etc/ owner=root mode=660 backup=yes'
ansible all -m copy -a 'src=/etc/hosts dest=/etc/ owner=root mode=644 backup=yes'
ansible all -m shell -a 'sudo mkdir -pv /data/deploy'
ansible all -m shell -a 'sudo chown -R tidb.root /data'


二、配置ssh认证(基于tidb普通用户)

su - tidb
ssh-keygen -t rsa 

cat /home/tidb/.ssh/id_rsa.pub

cat >>/root/.ssh/authorized_keys<<EOF
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCicV/LhrgjuEFZvIRnEZFnQ6/sKgLCSQ0UoKdjb07OlqfVczBHArgXAjBeCuqN3jzCOyMo4y9+6tRkeBcrheNcAA4FoIH1hLu/8JtfQFa9f5UpaIfUArwOf53hDqOGl4PvmpYsV9lT2C2mGPbrKUtqxJrCkyeCtwrtdh8XhDRhtlKwUc5VpezTcoYQuqc4YzeuNlpH+ItJRgks3jxpuNc3a2xFHZeNBkaDudYtBUZwZWCTBdr1pDR4jA/37gRgJZafvGI1zgkxcc3RGVHf/txDPDyZerHNaqi3LyE1CzssokEJxGtkK0UaqCHSKO7YAwWc1rCOXPJekOksZ0SeDY15 tidb@tidb-monitor
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDo5e+kFeYFbf2cRYpgslItfCinSUDtZdWRppLsoAtE3lJZopT6CuC0gO+Q7ewO9HScd23ex+fESBTha8vcHMwIfbj68187sccEvkxDExgQA2YQ75qpNKUU4AZIBvK5zQRz4qer7K1opYd0RGcYxaO20KUMcCR90pWPuv6DO8wSH9Mp4EqCc43dBHpNu0Q2m9Md2Rr+kGFNX8XSZU3yHbX7SsloyV3B6sEq0TSkoGHu+R0bQdVbY64CUfYNiHjmnTmkaIlHFrWgEwuEprLBJiGGlFTGfXdu6Q77rEMQgEairhOrbSnWZdCT3JYP4m+F9MKVxWTTwWfDOzMzeF4ayXMn tidb@tidb-pd01
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvenk7zSm1/UlSsjEpJ/GOVG8KmjCD/7fOTcuwChrbaWutT3PiBLm3F6Hrr95gHnaWI6FHlvzm3l2FFWK9TCDlQWRLlu6p3sTuuFI3ULpRJguKgoDx6Gt54YyHu1ctIkUeJYKCWntxQjsUD0Y28fM+SdggguZJQ4gS+0hfaVpZkRylb4quF3ZFBwqzb/NzW2MSl6+b1TWh1FkqcyOkeS+6WL9OsEPdmeHC2DkifiFYHzjf2mzZZVI9AHg2/pUXDl3Q8oD0xyHnYxy+MyoKcZ4TTJ6jiS4JJjuK5vSzUoecdVi/SPIfIkf7pnYZ+YiiTpCByofphfCurVEBoTyT/eS9 tidb@tidb-pd02
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDzBCGJnFUPQ8aUGvlKkTT3BiQFUuR/Ds4u4kjSjSTPefFaxcWPct8uJyo6vkJDo949iNnUIn0t0ktON2VmjNbT0gfNoaBMwzKb2CldlJxEdiCO7Mrs4BNZIVDr5IAfm5j1GP/1QbjVVdl7eUcOZvmG4ha43l8Nley815hz+nNMW2kP+tJTaUM+sE9UsdwVAESSzJXMMqhpI9I52P4KrUeLp3v3fMy6xTzNfTzjh2+7GMXol+/ydioBWhoc4XOTu/dhQ5xVls2SU2heg9u5ebDTVTcHix47ElM8gJcTVFz1CeNJVYPCz3lXPkM6No3NQ/NdYGV5QWZfKtC0C96LxQR9 tidb@tidb-pd03
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbFjfa0JAts35ukhE4ZXvj4GU/48xeQVzxF9T3cHzZLDgK9smUoyy5goqfVwLtCtrGe6+6zTliJMullDeU4n36nSA7lszAKTi3SFXXXbIV7RCD2L5KxkpEaDufP22knbYIKSabzUL5z1ZCjCroNpH89YOk/u+VW1nY7+ICaUd6zhG3YotYvfXknxWwJaYPyyw1iW0X25C92f8AwI0mtkMVxgVdfWN9NhrEnpAa9fxMuUiGMJ93aRgCRL0uPksihqoa5UPSlrAPUa9zbtu9VmuGlsTSy2SFSQC1cT1pbPXoZBIkx0zRPTK/6grQCfoYYjUVlTDC1qY6HiT+iRbRxMTJ tidb@tidb-db01
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCyq8cx3gZUfrG7KL7V4+u5s4j9CtpgYQ4jOj/FcepI3jH1DkPR99+r7W5gqtqTTyaVM55uZSOGPFMJ+GXlevn7IVlExZSRQZqOK+iGMP77vvE9cReiCmAEpAULv+W0FRZZxEvqocV57FS27yNw/3pv7kAbOhkROfR+3DI5zdTlMTMsD/7bPcw2J6OJ1FR//Wja3B8iGT1W0s7Tu/uC0x3nhfLOedk9djfE3U/O+R42WwgetQ5zGxuUACT+uIJIGiixGc0NwOVQW40ozwTpMUM36hr3H7SagXApvn9PSXeJCY35cjU7MUvlFRLxk9O0zvZBUMDheA8tC0At2tfRktRn tidb@tidb-db02
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRhZ9CzQ2ww61xWR/NKhY+SbiK4/CPqC2RVdG6BRNxaZQam6h7LnHWRjeDPMDc6aNzxGsR/ylAZmgk7cyPqEvjo/W8gbEp2g7qZj5Q4YHedgX48/p26dZV+3FXkcOUEZmvamDfo7xgIaEfCQzmIWqCOaCseBr5WBWQ3GOwEIU33c/d+j7hAJL4jt/6o50u1WiCmTqSbBXiHMyBi+PiE5kypwfSnkQquulFaSFmQ/zo892Bn+2YclqYNQlMQGXqEpRcjIX+tkXl1cK6W2sYQvOoxnvc/Ym66Cm4GWe8dvEeC1t51cfxndb007dbi8OO0VOwUZqibH1syZztxUnZGr37 tidb@tidb-kv01
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDvU2npqXvMxlAxHVUZtDpE0sTyntK2dRohq4fu/aF+wOqNLEdILFuv4koqNko+aG5lxrPfnv4WxvorJxvEuB6et866zu+DCc9S85TISz1lICgxJE4ZcRzE0ot73qfUZCBpkGFjfxoIO9fZrl5s2TCTvacrAjJQM9A+XdHFGfhgN1983DEvSyMIgPyNAnrEXZgbcPm6yjBn9toBBLoX3lbJe/3hJ3QB94HnNgIzzG8IIb4f8ZrPfAKrupkjj5miCQc4r5GFqFD3zWYc0SUnZ1ztqDC03pAXLDbmCf8+df0eb4KNROHhTr1gCXyMEAwOQfh2HXg9+um0Y+BwKXJH8BYt tidb@tidb-kv02
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDQs0BNMSE1yJXlsXMw2rNXewBxD7MaIz/J5b/4+6BJAYktQhs6ci2aqa/N2hdTft91QxbQk0DEknwafj7YMR6cPiTWk+1DFlJlJXSg6XiNKH+G3VxBay0MAxwz4o+L/9X06YhMncVqwGoJoDaAawC34WR0z/mJIF6keQnpJxfl85fQHKTzkci79Hqc4xUdVdF3+cNr6w955Urzq4ZwQaM90BCvhpiMS7C4cc4T9sY2LDF3lh9MxMYaRuH88Z7Z7aA+x65+VKHKzSFkhChXCpRK/Hp9jA1Q0mAYdN/5z4wYKA93SGm6tXVL/2vxzqNTeXgoH0izkhxTT+aySKkMzNmX tidb@tidb-kv03
EOF
